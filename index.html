<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì²´ìŠ¤ ë§ˆë¸” - ë ˆì´ì‹± ì—ë””ì…˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #020617;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(30, 58, 138, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(88, 28, 135, 0.4) 0%, transparent 50%),
                linear-gradient(to bottom right, #020617, #0f172a, #1e1b4b);
            background-attachment: fixed;
            color: #f8fafc;
            overflow: hidden;
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        /* ë‚´ë¹„ê²Œì´ì…˜ ë°” */
        .nav-bar {
            width: 100%; 
            height: 65px; 
            position: fixed; 
            top: 0; 
            left: 0; 
            z-index: 200;
            background: rgba(15, 23, 42, 0.4); 
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(251, 191, 36, 0.2);
        }

        .nav-content { height: 100%; max-width: 1400px; margin: 0 auto; padding: 0 16px; display: flex; justify-content: space-between; align-items: center; }
        .nav-logo { font-weight: 900; font-size: 1rem; color: #fbbf24; letter-spacing: -1px; cursor: pointer; display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
        
        .nav-right-area { display: flex; gap: 12px; align-items: center; }
        .nav-links { display: flex; gap: 8px; align-items: center; }
        
        .nav-link { 
            font-size: 10px; 
            font-weight: 700; 
            color: #fbbf24; 
            cursor: pointer; 
            transition: all 0.2s; 
            white-space: nowrap;
            padding: 5px 12px;
            border: 1px solid rgba(251, 191, 36, 0.5);
            border-radius: 8px;
            background: rgba(251, 191, 36, 0.05);
            box-shadow: 0 0 5px rgba(251, 191, 36, 0.1);
        }
        .nav-link:hover { 
            background: rgba(251, 191, 36, 0.2);
            border-color: #fbbf24;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.3);
            transform: translateY(-1px);
        }

        /* íŒì—… ê³µí†µ ìŠ¤íƒ€ì¼ */
        .overlay-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content {
            background: rgba(15, 23, 42, 0.98);
            border: 1px solid rgba(251, 191, 36, 0.4);
            border-radius: 24px;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            position: relative;
            padding: 25px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.6);
        }

        #ranking-list {
            overflow-y: auto;
            flex: 1;
            padding-right: 8px;
        }
        #ranking-list::-webkit-scrollbar { width: 4px; }
        #ranking-list::-webkit-scrollbar-track { background: transparent; }
        #ranking-list::-webkit-scrollbar-thumb { background: #fbbf24; border-radius: 10px; }

        /* 3D ì£¼ì‚¬ìœ„ ì˜¤ë²„ë ˆì´ */
        .dice-overlay {
            position: fixed;
            inset: 0;
            z-index: 500;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px);
            pointer-events: none;
        }

        .dice-container { width: 120px; height: 120px; perspective: 1000px; }
        .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .cube-face {
            position: absolute;
            width: 120px;
            height: 120px;
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(8px);
            border: 4px solid rgba(251, 191, 36, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            font-weight: 900;
            color: #fbbf24;
            border-radius: 16px;
            box-shadow: inset 0 0 20px rgba(251, 191, 36, 0.2), 0 0 15px rgba(251, 191, 36, 0.4);
        }
        .front  { transform: rotateY(0deg) translateZ(60px); }
        .back   { transform: rotateY(180deg) translateZ(60px); }
        .right  { transform: rotateY(90deg) translateZ(60px); }
        .left   { transform: rotateY(-90deg) translateZ(60px); }
        .top    { transform: rotateX(90deg) translateZ(60px); }
        .bottom { transform: rotateX(-90deg) translateZ(60px); }
        .rolling { animation: cubeRotate 0.4s linear infinite; }
        @keyframes cubeRotate { 0% { transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg); } 100% { transform: rotateX(360deg) rotateY(360deg) rotateZ(360deg); } }

        /* í™ˆ ìŠ¤í¬ë¦° */
        .home-container { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; perspective: 1000px; }
        .diamond-card {
            width: 280px;
            height: 280px;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(30px);
            border: 4px solid #fbbf24;
            position: relative;
            transform: rotate(45deg); 
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 60px rgba(251, 191, 36, 0.4), inset 0 0 40px rgba(251, 191, 36, 0.1);
            animation: diamondFloat 4s ease-in-out infinite;
        }
        @keyframes diamondFloat { 0%, 100% { transform: rotate(45deg) translate(0, 0); } 50% { transform: rotate(45deg) translate(-8px, -8px); } }
        .diamond-content { transform: rotate(-45deg); width: 160%; text-align: center; padding: 15px; }

        /* ê²Œì„ ë³´ë“œ ìŠ¤íƒ€ì¼ - ì„¸ê³„ì§€ë„ ë°°ê²½ ì¶”ê°€ */
        .board-container { perspective: 2000px; width: 100%; display: flex; align-items: center; justify-content: center; margin-top: -50px; position: relative; }
        .dice-board { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            grid-template-rows: repeat(7, 1fr); 
            gap: 16px; 
            width: 95vw; 
            max-width: 600px; 
            aspect-ratio: 1/1; 
            transform: rotateX(50deg) rotateZ(-45deg); 
            transform-style: preserve-3d; 
            position: relative; 
            background-color: transparent;
        }
        
        .dice-board::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/e/ec/World_map_blank_without_borders.svg');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 90%;
            opacity: 0.18;
            filter: invert(1) brightness(0.8);
            pointer-events: none;
            transform: translateZ(-5px) rotateZ(45deg) scale(1.4);
        }

        .tile { 
            aspect-ratio: 1/1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%); 
            border: 1px solid rgba(251, 191, 36, 0.4);
            border-radius: 12px; 
            font-weight: 900; 
            font-size: 1rem; 
            position: relative; 
            box-shadow: 
                0px 4px 0px 0px #78350f, 
                0px 8px 15px rgba(0,0,0,0.6), 
                inset 0 0 10px rgba(251, 191, 36, 0.1); 
            color: #fbbf24;
            transform-style: preserve-3d; 
            transform: translateZ(10px);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .tile-penalty { border-color: #ef4444; color: #ef4444; box-shadow: 0px 4px 0px 0px #7f1d1d, 0px 8px 15px rgba(0,0,0,0.6); }
        .tile-bonus { border-color: #22c55e; color: #22c55e; box-shadow: 0px 4px 0px 0px #14532d, 0px 8px 15px rgba(0,0,0,0.6); }
        
        .tile-step { 
            transform: translateZ(2px); 
            box-shadow: 0px 1px 0px 0px #78350f, 0px 2px 5px rgba(0,0,0,0.8);
            background: linear-gradient(135deg, #334155, #1e293b); 
        }

        .tile-active { 
            transform: translateZ(30px); 
            background: linear-gradient(135deg, #fbbf24, #d97706); 
            color: #020617; 
            box-shadow: 0px 15px 0px 0px #92400e, 0px 20px 40px rgba(0,0,0,0.6);
            border-color: #fff;
        }

        .tile.empty-space { background: transparent; border: none; box-shadow: none; color: transparent; pointer-events: none; }

        @keyframes tileShake {
            0%, 100% { transform: translateZ(15px) rotate(0); }
            25% { transform: translateZ(25px) rotate(3deg); }
            75% { transform: translateZ(25px) rotate(-3deg); }
        }
        .effect-penalty {
            animation: tileShake 0.1s infinite;
            background: linear-gradient(135deg, #7f1d1d, #ef4444) !important;
            color: white !important;
            border-color: #fca5a5 !important;
            box-shadow: 0px 8px 0px 0px #450a0a, 0 0 30px rgba(239, 68, 68, 0.6) !important;
            z-index: 20;
        }

        @keyframes tileGlow {
            0%, 100% { box-shadow: 0px 4px 0px 0px #14532d, 0 0 10px rgba(34, 197, 94, 0.4); transform: translateZ(15px) scale(1); }
            50% { box-shadow: 0px 15px 0px 0px #14532d, 0 0 40px rgba(34, 197, 94, 0.8); transform: translateZ(40px) scale(1.1); }
        }
        .effect-bonus {
            animation: tileGlow 0.5s infinite;
            background: linear-gradient(135deg, #14532d, #22c55e) !important;
            color: white !important;
            border-color: #86efac !important;
            z-index: 20;
        }

        .center-status-bubble {
            grid-area: 3/3 / 6/6;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            pointer-events: none;
            transform-style: preserve-3d;
        }
        
        /* ë§í’ì„  ë””ìì¸ ìˆ˜ì •: ê³¨ë“œ í…Œë‘ë¦¬ ìŠ¤íƒ€ì¼ */
        .status-content {
            background: #0f172a; /* ì–´ë‘ìš´ ë°°ê²½ */
            color: #fbbf24;    /* ê¸ˆìƒ‰ ê¸€ì”¨ */
            padding: 14px 24px;
            border-radius: 16px;
            font-weight: 900;
            font-size: 15px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8), 0 0 15px rgba(251, 191, 36, 0.3);
            transform: translateZ(80px) rotateZ(45deg) rotateX(-50deg);
            border: 2px solid #fbbf24; /* ëª…í™•í•œ ê³¨ë“œ í…Œë‘ë¦¬ */
            min-width: 150px;
            animation: statusFloat 2s ease-in-out infinite;
            text-shadow: 0 0 8px rgba(251, 191, 36, 0.4);
        }
        
        @keyframes statusFloat {
            0%, 100% { transform: translateZ(80px) rotateZ(45deg) rotateX(-50deg) translateY(0); }
            50% { transform: translateZ(100px) rotateZ(45deg) rotateX(-50deg) translateY(-10px); }
        }

        /* ì»¨íŠ¸ë¡¤ ì˜ì—­ */
        .game-controls-mini { 
            position: fixed; 
            bottom: 25px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 90%; 
            max-width: 550px; 
            padding: 12px 24px; 
            border-radius: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            z-index: 160; 
            background: rgba(15, 23, 42, 0.8); 
            backdrop-filter: blur(20px); 
            border: 2px solid #fbbf24; 
            box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
        }

        .dice-box { 
            width: 60px; 
            height: 60px; 
            background: linear-gradient(135deg, #fbbf24, #d97706); 
            border: 2px solid #fde68a;
            border-radius: 14px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.6rem; 
            font-weight: 900; 
            color: #020617; 
            cursor: pointer; 
            box-shadow: 0 8px 0 #b45309, 0 10px 20px rgba(0,0,0,0.4); 
            transition: all 0.1s ease; 
        }
        .dice-box:active { transform: translateY(4px); box-shadow: 0 4px 0 #b45309, 0 5px 10px rgba(0,0,0,0.4); }

        .compact-profile { width: 140px; padding: 10px; border-radius: 15px; background: rgba(15, 23, 42, 0.9); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; }
        .compact-profile.active-turn { border-color: #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.3); transform: scale(1.05); }

        /* ìºë¦­í„° SVG */
        .chess-piece { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            z-index: 150; 
            transform: translateZ(60px) rotateZ(45deg) rotateX(-50deg) scale(1.8); 
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); 
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .chess-svg { width: 100%; height: 100%; filter: drop-shadow(0 25px 15px rgba(0,0,0,0.7)); }

        @media (max-width: 640px) {
            .nav-links { display: flex; } 
            .nav-logo span { display: none; } 
            .diamond-card { width: 260px; height: 260px; }
            .dice-board { gap: 8px; }
            .compact-profile { width: 130px; }
            .nav-content { padding: 0 12px; }
        }
    </style>
</head>
<body>

    <div id="dice-overlay" class="dice-overlay">
        <div class="dice-container">
            <div id="cube" class="cube">
                <div class="cube-face front">1</div><div class="cube-face back">6</div><div class="cube-face right">3</div><div class="cube-face left">4</div><div class="cube-face top">2</div><div class="cube-face bottom">5</div>
            </div>
        </div>
    </div>

    <header class="nav-bar">
        <div class="nav-content">
            <div class="nav-logo" onclick="location.reload()">
                <div class="w-8 h-8 bg-amber-400 rounded-lg flex items-center justify-center text-black font-black">C</div>
                <span>ì²´ìŠ¤ ë§ˆë¸”</span>
            </div>
            
            <div class="nav-right-area">
                <div class="nav-links">
                    <!-- ë²„íŠ¼ ì´ë¦„ ìˆ˜ì •: ë­í‚¹ -> ë§ˆë¸” ë­í‚¹ / ì†Œì‹ -> íŒ¨ì¹˜ë…¸íŠ¸ -->
                    <span class="nav-link" onclick="toggleModal('ranking-modal')">ë§ˆë¸” ë­í‚¹</span>
                    <span class="nav-link" onclick="toggleModal('patch-modal')">íŒ¨ì¹˜ë…¸íŠ¸</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ë­í‚¹ ëª¨ë‹¬ -->
    <div id="ranking-modal" class="overlay-modal" onclick="event.target === this && toggleModal('ranking-modal')">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-xl font-black text-amber-400 italic">ë§ˆë¸” ë­í‚¹ ë¦¬ìŠ¤íŠ¸</h3>
                    <p class="text-[10px] text-white/40 font-bold">ìƒìœ„ 1200ëª…ì˜ í”Œë ˆì´ì–´</p>
                </div>
                <button onclick="toggleModal('ranking-modal')" class="text-white/20 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="space-y-2 pr-2" id="ranking-list">
            </div>
        </div>
    </div>

    <!-- íŒ¨ì¹˜ë…¸íŠ¸ ëª¨ë‹¬ -->
    <div id="patch-modal" class="overlay-modal" onclick="event.target === this && toggleModal('patch-modal')">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-black text-amber-400 italic">íŒ¨ì¹˜ ë…¸íŠ¸</h3>
                <button onclick="toggleModal('patch-modal')" class="text-white/20 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="space-y-4">
                <div class="border-l-2 border-amber-400 pl-4 py-1">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="bg-amber-400 text-black text-[9px] px-2 py-0.5 rounded-full font-black uppercase">v1.7.0</span>
                    </div>
                    <p class="text-xs font-bold text-white mb-1">UI ì»¤ìŠ¤í„°ë§ˆì´ì§•</p>
                    <ul class="text-[10px] text-white/50 space-y-1 list-disc pl-3">
                        <li>ìƒíƒœ ë§í’ì„  ê³¨ë“œ í”„ë¦¬ë¯¸ì—„ í…Œë‘ë¦¬ ë””ìì¸ ì ìš©</li>
                        <li>ë©”ì¸ ë‚´ë¹„ê²Œì´ì…˜ ë©”ë‰´ ëª…ì¹­ ë³€ê²½ ë° ì§ê´€ì„± ê°œì„ </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ê¸°ê¶Œ í™•ì¸ ëª¨ë‹¬ -->
    <div id="quit-confirm-modal" class="overlay-modal" onclick="event.target === this && toggleModal('quit-confirm-modal')">
        <div class="modal-content !max-w-[320px] text-center">
            <div class="mb-4">
                <div class="w-12 h-12 bg-red-500/20 border border-red-500/40 rounded-full flex items-center justify-center mx-auto mb-3">
                    <span class="text-red-500 text-xl font-black">!</span>
                </div>
                <h4 class="text-lg font-black text-white mb-2">í¬ê¸°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h4>
                <p class="text-[11px] text-white/50 leading-relaxed">
                    ì§€ê¸ˆ ë ˆì´ìŠ¤ë¥¼ í¬ê¸°í•˜ì‹œë©´<br>
                    <span class="text-red-400 font-bold">ë­í‚¹ í¬ì¸íŠ¸ 100ì ì´ ì°¨ê°</span>ë©ë‹ˆë‹¤.
                </p>
            </div>
            <div class="flex gap-2">
                <button onclick="toggleModal('quit-confirm-modal')" class="flex-1 bg-white/5 hover:bg-white/10 text-white font-bold py-3 rounded-xl text-xs transition-all">ê³„ì†í•˜ê¸°</button>
                <button onclick="applyQuitPenalty()" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-black py-3 rounded-xl text-xs transition-all shadow-lg shadow-red-500/20">í¬ê¸°í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <div id="home-screen" class="home-container">
        <div class="diamond-card">
            <div class="diamond-content">
                <h2 class="text-2xl font-black italic text-amber-400 tracking-tighter mb-1">ì²´ìŠ¤ ë ˆì´ìŠ¤</h2>
                <p class="text-white/40 text-[8px] font-bold tracking-[0.3em] mb-6 uppercase">3 LAPS ë¨¼ì € ëŒê¸° ì±Œë¦°ì§€</p>
                <div class="nickname-area max-w-[160px] mx-auto space-y-3">
                    <input type="text" id="nickname-input" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" maxlength="8" 
                           class="w-full bg-black/50 border border-amber-400/30 rounded-xl py-3 text-xs text-center text-white outline-none focus:border-amber-400 transition-all">
                    <button onclick="startGame()" class="w-full bg-amber-400 text-black font-black text-sm py-3 rounded-xl shadow-[0_0_20px_rgba(251,191,36,0.4)] hover:brightness-110 active:scale-95 transition-all">ë ˆì´ìŠ¤ ì‹œì‘</button>
                </div>
            </div>
        </div>
    </div>

    <div id="game-screen" class="hidden w-full h-full relative">
        <div class="flex flex-col items-center justify-center w-screen h-screen pt-12">
            <div class="flex gap-4 mb-4">
                <!-- í”Œë ˆì´ì–´ ì •ë³´ ì¹´ë“œ -->
                <div id="player-card" class="compact-profile active-turn">
                    <div class="flex justify-between mb-1">
                        <span class="text-[8px] text-amber-400 font-bold uppercase">ë­í‚¹ #412</span>
                        <span class="text-[10px] text-amber-400 font-black">LAP <span id="p-lap">1</span></span>
                    </div>
                    <div id="p-name" class="text-white font-black text-[12px] truncate mb-0.5">í”Œë ˆì´ì–´</div>
                    <div class="text-[8px] text-white/40 font-bold uppercase">ìŠ¹ë¥ : 50.0%</div>
                </div>
                <!-- AI ì •ë³´ ì¹´ë“œ -->
                <div id="ai-card" class="compact-profile">
                    <div class="flex justify-between mb-1">
                        <span class="text-[8px] text-slate-400 font-bold uppercase">ë­í‚¹ #1</span>
                        <span class="text-[10px] text-slate-400 font-black">LAP <span id="ai-lap">1</span></span>
                    </div>
                    <div id="ai-name" class="text-white font-black text-[12px] truncate mb-0.5">AI ì½”ì–´</div>
                    <div class="text-[8px] text-white/40 font-bold uppercase">ìŠ¹ë¥ : 99.9%</div>
                </div>
            </div>

            <div class="board-container">
                <div id="board" class="dice-board">
                    <div class="center-status-bubble">
                        <div id="game-status-text" class="status-content">ë‹¹ì‹ ì˜ ì°¨ë¡€!</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="game-controls-mini">
            <div class="flex flex-col items-start">
                <button onclick="confirmQuit()" class="text-[10px] font-bold text-red-500 mb-1">ê¸°ê¶Œ</button>
                <div class="text-white font-black text-lg italic"><span id="pos-display">00</span></div>
            </div>
            <div id="dice-btn" class="dice-box" onclick="handleRoll()">?</div>
            <div class="text-right">
                <div class="text-[9px] text-amber-400 font-black">ëª©í‘œ</div>
                <div class="text-white font-black text-lg italic">3 LAPS</div>
            </div>
        </div>
    </div>

    <script>
        let globalRankings = [];
        function generateRankings() {
            const firstNames = ["ê°•ë ¥í•œ", "ì‹ ì†í•œ", "ì–´ë‘ìš´", "ë¹›ë‚˜ëŠ”", "ëƒ‰ì² í•œ", "ìš©ê°í•œ", "ì˜ë¦¬í•œ", "ìš°ì•„í•œ", "ê±°ëŒ€í•œ", "ë‚ ì¹´ë¡œìš´", "ê³ ë…í•œ", "ì „ì„¤ì˜", "ë¶ˆë©¸ì˜", "ê¶ê·¹ì˜", "ë¯¸ì¹œ", "ì¡°ìš©í•œ", "ë¶ˆíƒ€ëŠ”", "ì–¼ì–´ë¶™ì€", "ì‹ ë¹„í•œ", "ê±°ì¹œ"];
            const lastNames = ["ê¸°ì‚¬", "êµ°ì£¼", "ì²´ìŠ¤ëŸ¬", "ë„ì „ì", "ì™•", "ì‚¬ëƒ¥ê¾¼", "ê·¸ë¦¼ì", "í­í’", "íŒŒê´´ì", "ìˆ˜í˜¸ì", "ê²€ê°", "ë§ˆë²•ì‚¬", "ë¡œê·¸", "ë§ˆìŠ¤í„°", "ì‹ ", "ì‹¬íŒì", "ë§ë ¹", "ìš©ì‚¬", "ê´‘ì‹ ë„", "ìˆ˜ë„ìŠ¹"];
            const ranks = [
                { name: "ê·¸ëœë“œë§ˆìŠ¤í„°", color: "text-red-500", bg: "bg-red-500/10", icon: "ğŸ‘‘" },
                { name: "ë§ˆìŠ¤í„°", color: "text-amber-500", bg: "bg-amber-500/10", icon: "ğŸ’" },
                { name: "ë‹¤ì´ì•„ëª¬ë“œ", color: "text-blue-400", bg: "bg-blue-400/10", icon: "ğŸ’ " },
                { name: "í”Œë˜í‹°ë„˜", color: "text-emerald-400", bg: "bg-emerald-400/10", icon: "âœ¨" },
                { name: "ê³¨ë“œ", color: "text-yellow-400", bg: "bg-yellow-400/10", icon: "ğŸ“€" },
                { name: "ì‹¤ë²„", color: "text-slate-400", bg: "bg-slate-400/10", icon: "ğŸ’¿" },
                { name: "ë¸Œë¡ ì¦ˆ", color: "text-orange-700", bg: "bg-orange-700/10", icon: "ğŸ¥‰" }
            ];
            const data = [];
            for (let i = 0; i < 1200; i++) {
                const nick = firstNames[Math.floor(Math.random() * firstNames.length)] + " " + lastNames[Math.floor(Math.random() * lastNames.length)];
                const score = 10000 - (i * 8) + Math.floor(Math.random() * 5);
                const winRate = (90 - (i * 0.05) + (Math.random() * 5)).toFixed(1);
                let rankIdx = 0;
                if (i > 5) rankIdx = 0; if (i > 50) rankIdx = 1; if (i > 150) rankIdx = 2; if (i > 400) rankIdx = 3; if (i > 800) rankIdx = 4; if (i > 1100) rankIdx = 5;
                data.push({ rank: i + 1, nick: nick, score: score, winRate: winRate, rankInfo: ranks[rankIdx] });
            }
            globalRankings = data;
        }

        function renderRanking() {
            const list = document.getElementById('ranking-list');
            const myRankHTML = `
                <div class="flex items-center justify-between p-3 bg-amber-400/20 border border-amber-400/50 rounded-xl mb-4 sticky top-0 z-10 backdrop-blur-md">
                    <div class="flex items-center gap-3">
                        <span class="font-black text-amber-400 w-8 text-center text-[10px]">#412</span>
                        <div class="flex flex-col">
                            <span class="text-sm font-black text-white">${player.name} (ë‹¹ì‹ )</span>
                            <span class="text-[9px] font-bold text-amber-400">ğŸ“€ ê³¨ë“œ IV | ìŠ¹ë¥  50.0%</span>
                        </div>
                    </div>
                    <span class="text-xs font-black text-amber-400">${stats.score} ì </span>
                </div>
            `;
            const listHTML = globalRankings.slice(0, 50).map(item => `
                <div class="flex items-center justify-between p-3 bg-white/5 border border-white/5 rounded-xl hover:bg-white/10 transition-colors">
                    <div class="flex items-center gap-3">
                        <span class="font-black ${item.rank <= 3 ? 'text-amber-400' : 'text-white/40'} w-8 text-center">${item.rank}</span>
                        <div class="flex flex-col">
                            <div class="flex items-center gap-1"><span class="text-[10px]">${item.rankInfo.icon}</span><span class="text-sm font-bold text-white/90">${item.nick}</span></div>
                            <div class="flex gap-2 items-center"><span class="text-[9px] font-bold ${item.rankInfo.color} uppercase">${item.rankInfo.name}</span><span class="text-[9px] text-white/40 font-bold">| ${item.winRate}%</span></div>
                        </div>
                    </div>
                    <div class="text-right"><span class="text-xs font-black text-white/60">${item.score.toLocaleString()}</span><p class="text-[8px] text-white/20 font-bold uppercase">ì </p></div>
                </div>
            `).join('');
            list.innerHTML = myRankHTML + listHTML;
        }

        generateRankings();

        let gameState = { turn: 'player', isMoving: false, active: false };
        let player = { name: "ìµëª…", pos: 0, lap: 1 };
        let ai = { name: "AI ì½”ì–´", pos: 0, lap: 1 };
        let stats = { wins: 0, score: 1000 };
        const GOAL_LAPS = 3;
        
        const penaltyCells = [4, 10, 16, 22];
        const bonusCells = [3, 7, 13, 19];
        const path = [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,6],[2,6],[3,6],[4,6],[5,6],[6,6],[6,5],[6,4],[6,3],[6,2],[6,1],[6,0],[5,0],[4,0],[3,0],[2,0],[1,0]];

        const chessIcons = {
            p: `<svg class="chess-svg" viewBox="0 0 100 100"><defs><linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#fde68a" /><stop offset="50%" style="stop-color:#fbbf24" /><stop offset="100%" style="stop-color:#b45309" /></linearGradient></defs><path d="M50 10 L40 25 L60 25 Z" fill="url(#goldGrad)" /><rect x="35" y="25" width="30" height="10" rx="2" fill="url(#goldGrad)" /><path d="M40 35 L35 80 L65 80 L60 35 Z" fill="url(#goldGrad)" /><rect x="30" y="80" width="40" height="10" rx="3" fill="url(#goldGrad)" /></svg>`,
            ai: `<svg class="chess-svg" viewBox="0 0 100 100"><defs><linearGradient id="silverGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#f8fafc" /><stop offset="50%" style="stop-color:#94a3b8" /><stop offset="100%" style="stop-color:#475569" /></linearGradient></defs><path d="M30 80 C 30 50, 40 30, 70 30 L 70 50 C 50 50, 45 60, 45 80 Z" fill="url(#silverGrad)" /><path d="M70 30 L 60 15 L 45 25 L 55 35 Z" fill="url(#silverGrad)" /><rect x="30" y="80" width="45" height="10" rx="3" fill="url(#silverGrad)" /></svg>`
        };

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(freq, type = 'sine', duration = 0.1) {
            try { if (audioCtx.state === 'suspended') audioCtx.resume(); const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime); gain.gain.setValueAtTime(0.05, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + duration); } catch(e) {}
        }

        function toggleModal(id) {
            const modal = document.getElementById(id);
            const isShowing = modal.style.display === 'flex';
            modal.style.display = isShowing ? 'none' : 'flex';
            if (id === 'ranking-modal' && !isShowing) renderRanking();
        }

        function updateUI() {
            document.getElementById('p-name').innerText = player.name;
            document.getElementById('p-lap').innerText = player.lap;
            document.getElementById('ai-lap').innerText = ai.lap;
            document.getElementById('player-card').classList.toggle('active-turn', gameState.turn === 'player');
            document.getElementById('ai-card').classList.toggle('active-turn', gameState.turn === 'ai');
            document.getElementById('game-status-text').innerText = gameState.isMoving ? "ì´ë™ ì¤‘..." : (gameState.turn === 'player' ? "ë‹¹ì‹ ì˜ ì°¨ë¡€!" : "AI ìƒê° ì¤‘...");
            if (!gameState.isMoving) renderPieces();
            document.getElementById('pos-display').innerText = (gameState.turn === 'player' ? player.pos : ai.pos).toString().padStart(2, '0');
        }

        function renderPieces() {
            document.querySelectorAll('.chess-piece').forEach(e => e.remove());
            renderPieceAt(player.pos, 'p', 'player-piece'); 
            renderPieceAt(ai.pos, 'ai', 'ai-piece');
        }

        function renderPieceAt(pos, type, id) {
            const tile = document.getElementById(`tile-${pos}`);
            if(!tile) return;
            const piece = document.createElement('div');
            piece.className = `chess-piece`;
            piece.id = id;
            piece.innerHTML = chessIcons[type];
            tile.appendChild(piece);
        }

        function initBoard() {
            const b = document.getElementById('board');
            const statusBubble = b.querySelector('.center-status-bubble');
            b.innerHTML = ''; 
            b.appendChild(statusBubble);
            
            for(let r=0; r<7; r++) {
                for(let c=0; c<7; c++) {
                    const t = document.createElement('div'); t.style.gridArea = `${r+1}/${c+1}`;
                    t.className = (r >= 2 && r <= 4 && c >= 2 && c <= 4) ? 'tile empty-space' : 'tile';
                    t.id = `c-${r}-${c}`; b.appendChild(t);
                }
            }
            path.forEach((p, i) => {
                const el = document.getElementById(`c-${p[0]}-${p[1]}`);
                if(el) { 
                    el.id = `tile-${i}`; 
                    el.innerText = i === 0 ? "ì‹œì‘" : i; 
                    if(penaltyCells.includes(i)) {
                        el.classList.add('tile-penalty');
                        el.innerHTML = `<div class='flex flex-col items-center'><span class='text-[9px]'>ê°ì </span></div>`;
                    } else if(bonusCells.includes(i)) {
                        el.classList.add('tile-bonus');
                        el.innerHTML = `<div class='flex flex-col items-center'><span class='text-[9px]'>ë³´ë„ˆìŠ¤</span></div>`;
                    }
                }
            });
            updateUI();
        }

        function startGame() {
            player.name = document.getElementById('nickname-input').value.trim() || "ìµëª…";
            player.lap = 1; ai.lap = 1; player.pos = 0; ai.pos = 0;
            gameState.active = true;
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            initBoard();
        }

        async function rollVisualDice() {
            const overlay = document.getElementById('dice-overlay');
            const cube = document.getElementById('cube');
            overlay.style.display = 'flex'; cube.classList.add('rolling');
            const val = Math.floor(Math.random() * 6) + 1;
            await new Promise(r => setTimeout(r, 600));
            cube.classList.remove('rolling'); playSfx(880, 'square', 0.15);
            const rots = { 1: "rotateX(0deg) rotateY(0deg)", 2: "rotateX(-90deg) rotateY(0deg)", 3: "rotateX(0deg) rotateY(-90deg)", 4: "rotateX(0deg) rotateY(90deg)", 5: "rotateX(90deg) rotateY(0deg)", 6: "rotateX(180deg) rotateY(0deg)" };
            cube.style.transform = rots[val];
            await new Promise(r => setTimeout(r, 500));
            overlay.style.display = 'none'; cube.style.transform = '';
            return val;
        }

        async function handleRoll() {
            if(gameState.isMoving || gameState.turn !== 'player') return;
            await executeTurn('player');
            if(gameState.active) { await new Promise(r => setTimeout(r, 800)); await executeTurn('ai'); }
        }

        async function executeTurn(type) {
            if(!gameState.active) return;
            gameState.isMoving = true; updateUI();
            const target = type === 'player' ? player : ai;
            const dice = await rollVisualDice();
            document.getElementById('dice-btn').innerText = dice;
            
            for(let i=0; i<dice; i++) {
                if(!gameState.active) return;
                const old = target.pos; 
                target.pos = (target.pos + 1) % path.length;
                
                if (old > target.pos) { 
                    target.lap++; 
                    if (target.lap > GOAL_LAPS) { endGame(type === 'player'); return; } 
                }
                await movePieceVisual(type === 'player' ? 'player-piece' : 'ai-piece', target.pos);
            }

            const currentTile = document.getElementById(`tile-${target.pos}`);
            if(penaltyCells.includes(target.pos)) {
                if (currentTile) currentTile.classList.add('effect-penalty');
                const moveBack = Math.floor(Math.random() * 2) + 2;
                playSfx(150, 'sawtooth', 0.4);
                document.getElementById('game-status-text').innerText = `ë’¤ë¡œ ${moveBack}ì¹¸ í›„í‡´!`;
                await new Promise(r => setTimeout(r, 1000));
                if (currentTile) currentTile.classList.remove('effect-penalty');
                for(let j=0; j<moveBack; j++) {
                    target.pos = (target.pos - 1 + path.length) % path.length;
                    await movePieceVisual(type === 'player' ? 'player-piece' : 'ai-piece', target.pos);
                }
            } else if(bonusCells.includes(target.pos)) {
                if (currentTile) currentTile.classList.add('effect-bonus');
                playSfx(1200, 'sine', 0.5);
                document.getElementById('game-status-text').innerText = `ë³´ë„ˆìŠ¤ êµ¬ì—­ í†µê³¼!`;
                await new Promise(r => setTimeout(r, 1500));
                if (currentTile) currentTile.classList.remove('effect-bonus');
            }

            gameState.turn = type === 'player' ? 'ai' : 'player'; 
            gameState.isMoving = false; 
            updateUI();
        }

        async function movePieceVisual(id, pos) {
            const p = document.getElementById(id); const t = document.getElementById(`tile-${pos}`);
            if (p && t) {
                p.classList.add('piece-moving'); t.classList.add('tile-step'); playSfx(400 + (pos * 10));
                await new Promise(r => { setTimeout(() => { t.appendChild(p); setTimeout(() => { p.classList.remove('piece-moving'); t.classList.remove('tile-step'); r(); }, 80); }, 120); });
            }
        }

        function endGame(win) {
            gameState.active = false;
            if (win) { stats.wins++; stats.score += 250; } 
            else { stats.score = Math.max(0, stats.score - 150); }
            alert(win ? "ìŠ¹ë¦¬í•˜ì…¨ìŠµë‹ˆë‹¤!" : "íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤.");
            goToHomeScreen();
        }

        function confirmQuit() { 
            toggleModal('quit-confirm-modal');
        }

        function applyQuitPenalty() {
            stats.score = Math.max(0, stats.score - 100);
            toggleModal('quit-confirm-modal');
            goToHomeScreen();
            playSfx(100, 'sawtooth', 0.3);
        }

        function goToHomeScreen() {
            gameState.active = false;
            gameState.isMoving = false;
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('home-screen').classList.remove('hidden');
            player.pos = 0;
            ai.pos = 0;
            document.getElementById('dice-btn').innerText = '?';
            updateUI();
        }
    </script>
</body>
</html>
