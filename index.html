<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì²´ìŠ¤ ë§ˆë¸” - ë ˆì´ì‹± ì—ë””ì…˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #000000;
            background-image: 
                linear-gradient(45deg, #111 25%, transparent 25%), 
                linear-gradient(-45deg, #111 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #111 75%), 
                linear-gradient(-45deg, transparent 75%, #111 75%);
            background-size: 80px 80px;
            background-position: 0 0, 0 40px, 40px -40px, -40px 0px;
            color: #f8fafc;
            overflow: hidden;
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        /* ë‚´ë¹„ê²Œì´ì…˜ ë°” */
        .nav-bar {
            width: 100%; 
            height: 65px; 
            position: fixed; 
            top: 0; 
            left: 0; 
            z-index: 200;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(251, 191, 36, 0.1);
        }

        .nav-content { height: 100%; max-width: 1400px; margin: 0 auto; padding: 0 16px; display: flex; justify-content: space-between; align-items: center; }
        .nav-logo { font-weight: 900; font-size: 1rem; color: #fbbf24; letter-spacing: -1px; cursor: pointer; display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
        
        .nav-right-area { display: flex; gap: 12px; align-items: center; }
        .nav-links { display: flex; gap: 8px; align-items: center; }
        
        .nav-link { 
            font-size: 10px; 
            font-weight: 700; 
            color: #fbbf24; 
            cursor: pointer; 
            transition: all 0.2s; 
            white-space: nowrap;
            padding: 5px 12px;
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 8px;
            background: rgba(251, 191, 36, 0.05);
        }

        /* ê²Œì„ ì¤‘ ìƒë‹¨ ëŒ€ì‹œë³´ë“œ */
        .game-top-dashboard {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 75px;
            z-index: 250;
            display: none;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.95), transparent);
            padding: 10px 16px;
        }
        .dashboard-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 16px;
            display: flex;
            align-items: center;
            padding: 8px 16px;
            gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }

        .db-stat { display: flex; flex-direction: column; align-items: center; min-width: 50px; }
        .db-label { font-size: 8px; font-weight: 900; color: rgba(251, 191, 36, 0.6); text-transform: uppercase; }
        .db-value { font-size: 11px; font-weight: 900; color: #fff; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .overlay-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content {
            background: rgba(15, 23, 42, 0.98);
            border: 1px solid rgba(251, 191, 36, 0.4);
            border-radius: 24px;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            position: relative;
            padding: 25px;
        }

        #ranking-list, .scroll-area { overflow-y: auto; flex: 1; padding-right: 8px; }

        /* ì£¼ì‚¬ìœ„ 3D */
        .dice-overlay {
            position: fixed;
            inset: 0;
            z-index: 500;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            pointer-events: none;
        }

        .dice-container { width: 120px; height: 120px; perspective: 1000px; }
        .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .cube-face {
            position: absolute;
            width: 120px;
            height: 120px;
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(8px);
            border: 4px solid rgba(251, 191, 36, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            font-weight: 900;
            color: #fbbf24;
            border-radius: 16px;
        }
        .front  { transform: rotateY(0deg) translateZ(60px); }
        .back   { transform: rotateY(180deg) translateZ(60px); }
        .right  { transform: rotateY(90deg) translateZ(60px); }
        .left   { transform: rotateY(-90deg) translateZ(60px); }
        .top    { transform: rotateX(90deg) translateZ(60px); }
        .bottom { transform: rotateX(-90deg) translateZ(60px); }
        .rolling { animation: cubeRotate 0.4s linear infinite; }
        @keyframes cubeRotate { 0% { transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg); } 100% { transform: rotateX(360deg) rotateY(360deg) rotateZ(360deg); } }

        /* í™ˆ ìŠ¤í¬ë¦° - ìŠ¤í˜ì´ë“œ A ì¹´ë“œ */
        .home-container { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; perspective: 1000px; }
        .spade-card {
            width: 280px;
            height: 400px;
            background: #ffffff;
            border-radius: 15px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), 0 0 20px rgba(255, 255, 255, 0.1);
            animation: cardFloat 4s ease-in-out infinite;
            padding: 20px;
            border: 1px solid #ddd;
        }
        @keyframes cardFloat { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-15px) rotate(1deg); } }
        
        .card-corner { position: absolute; display: flex; flex-direction: column; align-items: center; color: #1a1a1a; font-weight: 900; line-height: 1; }
        .corner-top { top: 15px; left: 15px; }
        .corner-bottom { bottom: 15px; right: 15px; transform: rotate(180deg); }
        .corner-rank { font-size: 24px; }
        .corner-suit { font-size: 18px; }

        .spade-center-icon { font-size: 100px; color: #1a1a1a; margin-bottom: 20px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2)); }
        .spade-content { width: 100%; text-align: center; z-index: 10; }

        /* ë‹‰ë„¤ì„ ì…ë ¥ì°½ ë° ë²„íŠ¼ ê³¨ë“œ ë””ìì¸ + í…Œë‘ë¦¬ ê°•í™” */
        #nickname-input {
            background: rgba(251, 191, 36, 0.05);
            border: 3px solid #fbbf24; 
            color: #000;
            box-shadow: 0 0 10px rgba(251, 191, 36, 0.2); 
        }
        #nickname-input::placeholder { color: rgba(180, 83, 9, 0.5); }
        #nickname-input:focus { border-color: #b45309; background: #fff; box-shadow: 0 0 15px rgba(251, 191, 36, 0.4); }

        .btn-gold-start {
            background: linear-gradient(135deg, #fde68a 0%, #fbbf24 50%, #d97706 100%);
            color: #000;
            text-shadow: 0 1px 0 rgba(255,255,255,0.4);
            border: 3px solid #78350f; 
            box-shadow: 0 4px 0 #78350f, 0 8px 15px rgba(180, 83, 9, 0.4);
        }
        .btn-gold-start:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #78350f, 0 4px 8px rgba(180, 83, 9, 0.3);
        }

        /* ê²Œì„ ë³´ë“œ */
        .board-container { perspective: 2000px; width: 100%; display: flex; align-items: center; justify-content: center; margin-top: -30px; position: relative; transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1); }
        .board-zoom { transform: scale(1.15) translateY(20px); }

        .dice-board { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            grid-template-rows: repeat(7, 1fr); 
            gap: 16px; 
            width: 95vw; 
            max-width: 600px; 
            aspect-ratio: 1/1; 
            transform: rotateX(50deg) rotateZ(-45deg); 
            transform-style: preserve-3d; 
            position: relative;
        }

        .tile { 
            aspect-ratio: 1/1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%); 
            border: 1px solid rgba(251, 191, 36, 0.4);
            border-radius: 12px; 
            font-weight: 900; 
            font-size: 1rem; 
            position: relative; 
            box-shadow: 0px 4px 0px 0px #78350f, 0px 8px 15px rgba(0,0,0,0.6);
            color: #fbbf24;
            transform-style: preserve-3d; 
            transform: translateZ(10px);
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .tile-penalty { border: 4px solid #ef4444; color: #ef4444; }
        .tile-bonus { border: 4px solid #22c55e; color: #22c55e; }
        .tile.empty-space { background: transparent; border: none; box-shadow: none; color: transparent; pointer-events: none; }

        .center-status-bubble { grid-area: 3/3 / 6/6; display: flex; align-items: center; justify-content: center; z-index: 10; pointer-events: none; transform-style: preserve-3d; }
        .status-content {
            background: #0f172a; color: #fbbf24; padding: 14px 24px; border-radius: 16px; font-weight: 900; font-size: 15px; text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); transform: translateZ(80px) rotateZ(45deg) rotateX(-50deg); border: 2px solid #fbbf24;
        }

        /* ì»¨íŠ¸ë¡¤ ì˜ì—­ */
        .game-controls-mini { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 550px; padding: 12px 24px; border-radius: 20px; display: flex; align-items: center; justify-content: space-between; z-index: 160; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(20px); border: 2px solid #fbbf24; }
        .dice-box { width: 60px; height: 60px; background: linear-gradient(135deg, #fbbf24, #d97706); border: 2px solid #fde68a; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 1.6rem; font-weight: 900; color: #020617; cursor: pointer; box-shadow: 0 8px 0 #b45309; transition: all 0.1s; }
        .compact-profile { width: 140px; padding: 10px; border-radius: 15px; background: rgba(0, 0, 0, 0.9); border: 1px solid rgba(255, 255, 255, 0.1); }
        .compact-profile.active-turn { border-color: #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.3); }

        /* ê¸°ë¬¼ */
        .chess-piece { position: absolute; width: 100%; height: 100%; z-index: 150; transform: translateZ(60px) rotateZ(45deg) rotateX(-50deg) scale(1.8); transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); pointer-events: none; display: flex; align-items: center; justify-content: center; }
        .chess-svg { width: 100%; height: 100%; filter: drop-shadow(0 25px 15px rgba(0,0,0,0.7)); }

        .item-badge { width: 20px; height: 20px; border-radius: 5px; background: #1e293b; border: 1px solid #fbbf24; display: flex; align-items: center; justify-content: center; font-size: 10px; position: relative; }
        .item-count { position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; font-size: 8px; padding: 1px 3px; border-radius: 10px; font-weight: 900; }

        .hidden { display: none !important; }

        /* ë­í‚¹ UI ê°•í™” */
        .ranking-item { padding: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; display: flex; align-items: center; gap: 12px; margin-bottom: 8px; transition: all 0.2s; }
        .ranking-item:hover { background: rgba(255, 255, 255, 0.08); transform: translateX(5px); }
        .ranking-rank { font-weight: 900; color: #fbbf24; min-width: 40px; text-align: center; font-size: 14px; font-style: italic; }
        .ranking-info { flex: 1; }
        .ranking-name { font-weight: 700; color: #fff; font-size: 13px; display: flex; align-items: center; gap: 6px; }
        .ranking-stats { font-size: 10px; color: rgba(255, 255, 255, 0.5); display: flex; gap: 8px; margin-top: 2px; }
        .ranking-tier-icon { background: #fbbf24; color: #000; font-size: 7px; font-weight: 900; padding: 2px 5px; border-radius: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
        .search-bar { background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 12px; padding: 10px 16px; margin-bottom: 16px; width: 100%; color: white; outline: none; font-size: 12px; }
        .search-bar:focus { border-color: #fbbf24; }
    </style>
</head>
<body oncontextmenu="return false">

    <div id="dice-overlay" class="dice-overlay">
        <div class="dice-container">
            <div id="cube" class="cube">
                <div class="cube-face front">1</div><div class="cube-face back">6</div><div class="cube-face right">3</div><div class="cube-face left">4</div><div class="cube-face top">2</div><div class="cube-face bottom">5</div>
            </div>
        </div>
    </div>

    <!-- í™ˆ í™”ë©´ ë‚´ë¹„ê²Œì´ì…˜ ë°” -->
    <header id="home-nav" class="nav-bar">
        <div class="nav-content">
            <div class="nav-logo" onclick="location.reload()">
                <div class="w-8 h-8 bg-amber-400 rounded-lg flex items-center justify-center text-black font-black">C</div>
                <span>ì²´ìŠ¤ ë§ˆë¸”</span>
            </div>
            <div class="nav-right-area">
                <div class="nav-links">
                    <span class="nav-link" onclick="openRanking()">ë§ˆë¸” ë­í‚¹</span>
                    <span class="nav-link" onclick="toggleModal('patch-modal')">íŒ¨ì¹˜ë…¸íŠ¸</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ê²Œì„ ì¤‘ ìƒë‹¨ ëŒ€ì‹œë³´ë“œ (ì ìˆ˜ ì œê±°ë¨) -->
    <div id="game-dashboard" class="game-top-dashboard">
        <div class="dashboard-container">
            <div id="db-rank-icon" class="w-10 h-10 flex items-center justify-center bg-amber-400/20 border border-amber-400/40 rounded-xl text-xl">ğŸ“€</div>
            <div class="flex flex-col flex-1">
                <div class="flex items-center gap-2">
                    <span id="db-name" class="font-black text-sm text-white">í”Œë ˆì´ì–´</span>
                    <span class="bg-amber-400 text-black text-[8px] px-1.5 py-0.5 rounded font-black uppercase">GOLD IV</span>
                </div>
                <div class="flex gap-4 mt-1">
                    <div class="db-stat"><span class="db-label">ìˆœìœ„</span><span class="db-value">#412</span></div>
                    <div class="db-stat"><span class="db-label">ìŠ¹ë¥ </span><span class="db-value">50.0%</span></div>
                    <div class="db-stat"><span class="db-label">ì „ì </span><span class="db-value">12ìŠ¹ 12íŒ¨</span></div>
                </div>
            </div>
            <div id="db-inventory" class="flex gap-1.5 border-l border-white/10 pl-4"></div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ ì°½ë“¤ -->
    <div id="shop-modal" class="overlay-modal" onclick="event.target === this && toggleModal('shop-modal')">
        <div class="modal-content">
            <h3 class="text-xl font-black text-amber-400 italic mb-6">ì•„ì´í…œ ìƒì </h3>
            <div class="scroll-area space-y-3">
                <div class="p-4 bg-white/5 border border-white/10 rounded-2xl flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-amber-400/20 rounded-xl flex items-center justify-center text-xl">ğŸ›¡ï¸</div>
                        <div><div class="font-black text-sm text-white">ë²Œì¹™ì¹¸ ì‰´ë“œ</div><div class="text-[9px] text-white/40">í›„í‡´ ë°©ì§€</div></div>
                    </div>
                    <button onclick="buyItem('shield')" class="bg-amber-400 text-black font-black text-xs px-4 py-2 rounded-lg">ë¬´ë£Œ</button>
                </div>
                <div class="p-4 bg-white/5 border border-white/10 rounded-2xl flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-emerald-400/20 rounded-xl flex items-center justify-center text-xl">âš¡</div>
                        <div><div class="font-black text-sm text-white">í”„ë¦¬íŒ¨ìŠ¤</div><div class="text-[9px] text-white/40">ë²Œì¹™ì¹¸ì—ì„œ ì „ì§„</div></div>
                    </div>
                    <button onclick="buyItem('freepass')" class="bg-amber-400 text-black font-black text-xs px-4 py-2 rounded-lg">ë¬´ë£Œ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ê¸°ê¶Œ í™•ì¸ ëª¨ë‹¬ -->
    <div id="resign-modal" class="overlay-modal" onclick="event.target === this && toggleModal('resign-modal')">
        <div class="modal-content text-center">
            <h3 class="text-xl font-black text-red-500 italic mb-2">ì •ë§ ê¸°ê¶Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
            <p id="resign-info" class="text-xs text-white/60 mb-8 leading-relaxed"></p>
            <div class="flex gap-3">
                <button onclick="toggleModal('resign-modal')" class="flex-1 bg-white/10 text-white font-black py-3 rounded-xl">ê³„ì†í•˜ê¸°</button>
                <button onclick="handleResign()" class="flex-1 bg-red-500 text-white font-black py-3 rounded-xl shadow-lg shadow-red-500/20">ê¸°ê¶Œ í™•ì •</button>
            </div>
        </div>
    </div>

    <!-- ë­í‚¹ ëª¨ë‹¬ -->
    <div id="ranking-modal" class="overlay-modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-black text-amber-400 italic">ë§ˆë¸” ë­í‚¹ (Top 1000)</h3>
                <button onclick="toggleModal('ranking-modal')" class="text-white/40 hover:text-white transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            <input type="text" id="rank-search" placeholder="ë‹‰ë„¤ì„ìœ¼ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”..." class="search-bar" oninput="filterRanking()">
            <div id="ranking-list"></div>
        </div>
    </div>

    <div id="patch-modal" class="overlay-modal" onclick="event.target === this && toggleModal('patch-modal')">
        <div class="modal-content">
            <h3 class="text-xl font-black text-amber-400 italic mb-6">íŒ¨ì¹˜ ë…¸íŠ¸</h3>
            <div class="text-xs text-white/50">v2.5.1: ë­í‚¹ ê²€ìƒ‰ ë° ìƒì„¸ UI ê°œì„  (ìˆœìœ„/í‹°ì–´/ë‹‰ë„¤ì„/ìŠ¹ë¥ )</div>
        </div>
    </div>

    <!-- í™ˆ í™”ë©´ -->
    <div id="home-screen" class="home-container">
        <div class="spade-card">
            <div class="card-corner corner-top"><div class="corner-rank">A</div><div class="corner-suit">â™ </div></div>
            <div class="card-corner corner-bottom"><div class="corner-rank">A</div><div class="corner-suit">â™ </div></div>
            <div class="spade-center-icon">â™ </div>
            <div class="spade-content">
                <h2 class="text-2xl font-black italic text-black mb-1">ì²´ìŠ¤ ë ˆì´ìŠ¤</h2>
                <p class="text-black/40 text-[8px] font-bold tracking-[0.3em] mb-8 uppercase">ACE OF SPADES EDITION</p>
                <div class="nickname-area max-w-[200px] mx-auto space-y-4">
                    <input type="text" id="nickname-input" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" maxlength="8" class="w-full rounded-xl py-3 text-xs text-center font-bold outline-none transition-all">
                    <button onclick="startGame()" class="w-full btn-gold-start font-black text-sm py-4 rounded-xl shadow-xl active:scale-95 transition-all">ë ˆì´ìŠ¤ ì‹œì‘</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ê²Œì„ í™”ë©´ -->
    <div id="game-screen" class="hidden w-full h-full relative">
        <div class="flex flex-col items-center justify-center w-screen h-screen pt-20">
            <div class="flex gap-4 mb-4">
                <div id="p-lap-card" class="compact-profile active-turn text-center">
                    <span class="text-[8px] text-amber-400 font-bold uppercase">ë‚´ ìœ„ì¹˜</span>
                    <div class="text-white font-black text-sm">LAP <span id="p-lap">1</span></div>
                </div>
                <div id="ai-lap-card" class="compact-profile text-center">
                    <span class="text-[8px] text-slate-400 font-bold uppercase">AI ìœ„ì¹˜</span>
                    <div class="text-white font-black text-sm">LAP <span id="ai-lap">1</span></div>
                </div>
            </div>
            <div id="board-container" class="board-container">
                <div id="board" class="dice-board">
                    <div class="center-status-bubble">
                        <div id="game-status-text" class="status-content">ë‹¹ì‹ ì˜ ì°¨ë¡€!</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="game-controls-mini">
            <button onclick="handleResignClick()" class="text-[10px] font-bold text-red-500 border border-red-500/50 hover:bg-red-500/10 px-3 py-1.5 rounded-lg transition-colors">ê¸°ê¶Œí•˜ê¸°</button>
            <div class="flex items-center gap-3">
                <button onclick="toggleModal('shop-modal')" class="w-10 h-10 bg-white/10 border border-white/20 rounded-xl flex items-center justify-center text-xl">ğŸ›’</button>
                <div id="dice-btn" class="dice-box" onclick="handleRoll()">?</div>
            </div>
            <div class="text-right">
                <div class="text-[9px] text-amber-400 font-black">ìœ„ì¹˜</div>
                <div class="text-white font-black text-lg italic"><span id="pos-display">00</span></div>
            </div>
        </div>
    </div>

    <script>
        let gameState = { turn: 'player', isMoving: false, active: false };
        let player = { name: "ìµëª…", pos: 0, lap: 1, items: { shield: 0, freepass: 0 }, score: 1000 };
        let ai = { pos: 0, lap: 1 };
        let currentRankingData = [];
        const GOAL_LAPS = 3;
        const penaltyCells = [4, 11, 18];
        const bonusCells = [7, 14, 21];
        const path = [[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,6],[2,6],[3,6],[4,6],[5,6],[6,6],[6,5],[6,4],[6,3],[6,2],[6,1],[6,0],[5,0],[4,0],[3,0],[2,0],[1,0]];
        const chessIcons = {
            p: `<svg class="chess-svg" viewBox="0 0 100 100"><defs><linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#fde68a" /><stop offset="50%" style="stop-color:#fbbf24" /><stop offset="100%" style="stop-color:#b45309" /></linearGradient></defs><path d="M50 10 L40 25 L60 25 Z" fill="url(#goldGrad)" /><rect x="35" y="25" width="30" height="10" rx="2" fill="url(#goldGrad)" /><path d="M40 35 L35 80 L65 80 L60 35 Z" fill="url(#goldGrad)" /><rect x="30" y="80" width="40" height="10" rx="3" fill="url(#goldGrad)" /></svg>`,
            ai: `<svg class="chess-svg" viewBox="0 0 100 100"><defs><linearGradient id="silverGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#f8fafc" /><stop offset="50%" style="stop-color:#94a3b8" /><stop offset="100%" style="stop-color:#475569" /></linearGradient></defs><path d="M30 80 C 30 50, 40 30, 70 30 L 70 50 C 50 50, 45 60, 45 80 Z" fill="url(#silverGrad)" /><path d="M70 30 L 60 15 L 45 25 L 55 35 Z" fill="url(#silverGrad)" /><rect x="30" y="80" width="45" height="10" rx="3" fill="url(#silverGrad)" /></svg>`
        };

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(freq, type = 'sine', duration = 0.1) {
            try { const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime); gain.gain.setValueAtTime(0.05, audioCtx.currentTime); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + duration); } catch(e) {}
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
            if (id === 'ranking-modal') {
                document.getElementById('rank-search').value = '';
            }
        }

        function openRanking() {
            const list = document.getElementById('ranking-list');
            list.innerHTML = '';
            const firstNames = ["ê°•ë ¥í•œ", "ì‹ ì†í•œ", "ë¹›ë‚˜ëŠ”", "ì–´ë‘ ì˜", "í™©ê¸ˆì˜", "ì „ì„¤ì˜", "ë¯¸ì¹œë“¯í•œ", "ìš©ê°í•œ", "ê³ ìš”í•œ", "ë‚ ì¹´ë¡œìš´", "ì˜ë¦¬í•œ", "ë¬´ì ì˜", "ê±°ëŒ€í•œ", "ì°¨ê°€ìš´", "ë¶ˆíƒ€ëŠ”"];
            const lastNames = ["ì²´ìŠ¤ì™•", "ë§ˆë¸”ëŸ¬", "ë ˆì´ì„œ", "ê¸°ì‚¬", "ë„ì „ì", "ìŠ¹ë¶€ì‚¬", "í”„ë¡œ", "ë§ˆìŠ¤í„°", "ì²œì¬", "ì˜ì›…", "ì „ì‚¬", "ê·¸ë¦¼ì", "í­í’", "ë²ˆê°œ", "ë¶ˆê½ƒ"];
            const tiers = ["CHALLENGER", "MASTER", "DIAMOND", "PLATINUM", "GOLD", "SILVER", "BRONZE"];
            
            currentRankingData = [];
            for (let i = 1; i <= 1000; i++) {
                const randomName = firstNames[Math.floor(Math.random() * firstNames.length)] + " " + lastNames[Math.floor(Math.random() * lastNames.length)] + " " + Math.floor(Math.random() * 999);
                const randomScore = 5000 - (i * 4) + Math.floor(Math.random() * 50);
                const randomWinRate = (90 - (i * 0.05) + Math.floor(Math.random() * 5)).toFixed(1);
                const tierIdx = Math.min(tiers.length - 1, Math.floor(i / 150));
                currentRankingData.push({ rank: i, name: randomName, score: Math.max(0, randomScore), winRate: Math.max(0, randomWinRate), tier: tiers[tierIdx] });
            }
            displayRanking(currentRankingData);
            toggleModal('ranking-modal');
        }

        function displayRanking(data) {
            const list = document.getElementById('ranking-list');
            list.innerHTML = '';
            if (data.length === 0) {
                list.innerHTML = '<div class="text-center py-10 text-white/20 text-xs">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            data.forEach(user => {
                const item = document.createElement('div');
                item.className = 'ranking-item';
                item.innerHTML = `
                    <div class="ranking-rank">#${user.rank}</div>
                    <div class="ranking-info">
                        <div class="ranking-name">
                            <span>${user.name}</span>
                            <span class="ranking-tier-icon">${user.tier}</span>
                        </div>
                        <div class="ranking-stats">
                            <span>ì ìˆ˜: <b>${user.score.toLocaleString()}</b></span>
                            <span>ìŠ¹ë¥ : <b class="text-amber-400">${user.winRate}%</b></span>
                        </div>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        function filterRanking() {
            const query = document.getElementById('rank-search').value.toLowerCase();
            const filtered = currentRankingData.filter(user => user.name.toLowerCase().includes(query));
            displayRanking(filtered);
        }

        function handleResignClick() {
            const infoEl = document.getElementById('resign-info');
            const itemTotal = player.items.shield + player.items.freepass;
            infoEl.innerHTML = `í˜„ì¬ <b>${player.lap}ë°”í€´</b> ì§„í–‰ ì¤‘ì´ë©°,<br>ë³´ìœ í•œ <b>ì•„ì´í…œ ${itemTotal}ê°œ</b>ëŠ”<br>ëª¨ë‘ ì†Œë©¸ë©ë‹ˆë‹¤.`;
            toggleModal('resign-modal');
        }

        function handleResign() {
            gameState = { turn: 'player', isMoving: false, active: false };
            player = { name: "ìµëª…", pos: 0, lap: 1, items: { shield: 0, freepass: 0 }, score: 1000 };
            ai = { pos: 0, lap: 1 };
            toggleModal('resign-modal');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('game-dashboard').style.display = 'none';
            document.getElementById('home-screen').classList.remove('hidden');
            document.getElementById('home-nav').classList.remove('hidden');
            const nickInput = document.getElementById('nickname-input');
            nickInput.value = "";
            nickInput.focus();
            playSfx(200, 'sawtooth', 0.3);
        }

        function updateUI() {
            document.getElementById('db-name').innerText = player.name;
            document.getElementById('p-lap').innerText = player.lap;
            document.getElementById('ai-lap').innerText = ai.lap;
            document.getElementById('pos-display').innerText = (gameState.turn === 'player' ? player.pos : ai.pos).toString().padStart(2, '0');
            document.getElementById('game-status-text').innerText = gameState.isMoving ? "ì´ë™ ì¤‘..." : (gameState.turn === 'player' ? "ë‹¹ì‹ ì˜ ì°¨ë¡€!" : "AI ìƒê° ì¤‘...");
            const inv = document.getElementById('db-inventory'); inv.innerHTML = '';
            if(player.items.shield > 0) inv.innerHTML += `<div class="item-badge">ğŸ›¡ï¸<span class="item-count">${player.items.shield}</span></div>`;
            if(player.items.freepass > 0) inv.innerHTML += `<div class="item-badge">âš¡<span class="item-count">${player.items.freepass}</span></div>`;
            if (!gameState.isMoving) renderPieces();
        }

        function renderPieces() { document.querySelectorAll('.chess-piece').forEach(e => e.remove()); renderPieceAt(player.pos, 'p', 'player-piece'); renderPieceAt(ai.pos, 'ai', 'ai-piece'); }
        function renderPieceAt(pos, type, id) { const tile = document.getElementById(`tile-${pos}`); if(!tile) return; const piece = document.createElement('div'); piece.className = `chess-piece`; piece.id = id; piece.innerHTML = chessIcons[type]; tile.appendChild(piece); }

        function initBoard() {
            const b = document.getElementById('board'); b.innerHTML = '<div class="center-status-bubble"><div id="game-status-text" class="status-content">ë‹¹ì‹ ì˜ ì°¨ë¡€!</div></div>';
            for(let r=0; r<7; r++) { for(let c=0; c<7; c++) { const t = document.createElement('div'); t.style.gridArea = `${r+1}/${c+1}`; t.className = (r >= 2 && r <= 4 && c >= 2 && c <= 4) ? 'tile empty-space' : 'tile'; t.id = `c-${r}-${c}`; b.appendChild(t); } }
            path.forEach((p, i) => { const el = document.getElementById(`c-${p[0]}-${p[1]}`); if(el) { el.id = `tile-${i}`; el.innerText = i === 0 ? "ì‹œì‘" : i; if(penaltyCells.includes(i)) el.classList.add('tile-penalty'); if(bonusCells.includes(i)) el.classList.add('tile-bonus'); } });
            updateUI();
        }

        function startGame() {
            player.name = document.getElementById('nickname-input').value.trim() || "ìµëª…";
            gameState.active = true;
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('home-nav').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('game-dashboard').style.display = 'block';
            initBoard();
        }

        async function rollVisualDice() {
            const overlay = document.getElementById('dice-overlay'); const cube = document.getElementById('cube'); overlay.style.display = 'flex'; cube.classList.add('rolling');
            const val = Math.floor(Math.random() * 6) + 1; await new Promise(r => setTimeout(r, 600)); cube.classList.remove('rolling'); playSfx(880, 'square', 0.15); overlay.style.display = 'none'; return val;
        }

        async function handleRoll() {
            if(gameState.isMoving || gameState.turn !== 'player') return;
            await executeTurn('player');
            if(gameState.active) { await new Promise(r => setTimeout(r, 800)); await executeTurn('ai'); }
        }

        async function executeTurn(type) {
            if(!gameState.active) return; gameState.isMoving = true; updateUI();
            const container = document.getElementById('board-container'); container.classList.add('board-zoom');
            const target = type === 'player' ? player : ai;
            const dice = await rollVisualDice(); document.getElementById('dice-btn').innerText = dice;
            for(let i=0; i<dice; i++) {
                const old = target.pos; target.pos = (target.pos + 1) % path.length;
                if (old > target.pos) { target.lap++; if (target.lap > GOAL_LAPS) { alert(type === 'player' ? "ìŠ¹ë¦¬!" : "íŒ¨ë°°!"); location.reload(); return; } }
                await movePieceVisual(type === 'player' ? 'player-piece' : 'ai-piece', target.pos);
            }
            if(penaltyCells.includes(target.pos)) {
                if(type === 'player' && player.items.shield > 0) { player.items.shield--; playSfx(300); }
                else { for(let j=0; j<2; j++) { target.pos = (target.pos - 1 + path.length) % path.length; await movePieceVisual(type === 'player' ? 'player-piece' : 'ai-piece', target.pos); } }
            }
            container.classList.remove('board-zoom');
            gameState.turn = type === 'player' ? 'ai' : 'player'; gameState.isMoving = false; updateUI();
        }

        async function movePieceVisual(id, pos) { const p = document.getElementById(id); const t = document.getElementById(`tile-${pos}`); if (p && t) { t.appendChild(p); playSfx(400 + (pos * 10)); await new Promise(r => setTimeout(r, 200)); } }
        function buyItem(type) { player.items[type]++; updateUI(); playSfx(523); }
    </script>
</body>
</html>
